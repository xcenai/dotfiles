"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[6025],{22578:(e,r,i)=>{i.d(r,{$:()=>m});var s=i(64593),t=i(96206),a=i(69691),n=i(8341),c=i(89952),o=i(67294),l=i(51615),d=i(24183);var u=i(85893);function g(e){return e.includes("Spotify")?e:`Spotify – ${e}`}const m=({children:e,usePlayingItem:r})=>{let i=g(e);(e=>{const{mainLandmarkRef:r}=(0,d.Oh)(),i=(0,l.k6)(),s=i.location?.state?.preventMoveFocus,t=(0,o.useRef)(i.length<2);t.current=i.length<2,(0,o.useEffect)((()=>{const i=r.current;!s&&!t.current&&i&&e&&(i.setAttribute("aria-label",e),i.focus())}),[e,r,s])})(e);const{isPlaying:m}=(0,a.IK)(),y=(0,n.Y)((e=>e?.item));return y&&(m||r)&&((0,c.G_)(y)?i=[y.name,y.artists.map((e=>e.name)).join(t.ag.getSeparator())].join(" • "):(0,c.iw)(y)?i=[y.name,y.show.name].join(" • "):(0,c.k6)(y)&&(i=g(t.ag.get("ad-formats.advertisement")))),(0,u.jsx)(s.q,{defaultTitle:"Spotify",defer:!1,children:(0,u.jsx)("title",{children:i})})}},70369:(e,r,i)=>{i.d(r,{$:()=>s.$});var s=i(22578)},18130:(e,r,i)=>{i.r(r),i.d(r,{default:()=>je});var s=i(35150),t=i(86706),a=i(69518),n=i.n(a),c=i(73012),o=i(87577),l=i(37081),d=i(49207),u=i(39270),g=i(8341),m=i(55799),y=i(49104),v=i(70369),f=i(57451),p=i(88767),h=i(96511),b=i(48015);var x=i(68120);function k(e,r,i){const{startTimeMs:s,words:t}=e,a=i[r+1];return{start:s||0,end:a&&a.startTimeMs?a.startTimeMs:1/0,text:t}}function S(e){const r=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}(e);return b.I.fromRGB(r).toCSS(b.j.RGB)}const L=(e,r,i=!1)=>{const s=["lyrics",{uri:e,image:r,vocalRemoval:i}],{data:t,isLoading:a,isError:c}=(0,p.useQuery)(s,(async()=>e&&r&&n().isTrack(e)?await async function(e,r,i){try{const a=await(0,x.S)(e,r,i);return{hasLyrics:!0,isTimeSynced:(t=a.lyrics.syncType,"LINE_SYNCED"===t||"SYLLABLE_SYNCED"===t),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(k),colors:(s=a.colors,{text:S(s.text),activeText:S(s.highlightText),background:S(s.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1}}catch(e){if(e instanceof h.m&&404===e.status)return{hasLyrics:!1};throw e}var s,t}(e,r,i):{hasLyrics:!1}),{cacheTime:18e5});return{data:t??null,loading:a,error:c}};var j=i(67294),N=i(32667),I=i(81898),w=i(96206),T=i(23716),D=i(52759),E=i(15852),_=i(24643),C=i(8271);var B=i(97650),G=i(32648);const O="lyrics-lyrics-contentContainer",F="lyrics-lyrics-contentWrapper",V="lyrics-lyricsContent-lyric",A="lyrics-lyricsContent-active",R="lyrics-lyricsContent-highlight",P="lyrics-lyricsContent-unsynced",Y="lyrics-lyricsContent-provider",H="lyrics-lyricsContent-description";var M=i(85893);const U=j.memo((function({onObserve:e,text:r,lineNumber:i,activeLineIndex:t,isTimeSynced:a,handleLyricsClick:n}){const{ref:c,inView:o}=(0,B.YD)({threshold:0,triggerOnce:!0});(0,j.useEffect)((()=>{o&&e(r)}),[o,e,r]);const l=(0,j.useRef)(),d=(0,j.useRef)(!0),u=(0,j.useContext)(G.VX);(0,j.useEffect)((()=>{if(a&&t===i||a&&0===i&&t<0){const e=l.current?.getBoundingClientRect().top,r=u.scrollNodeRef.current?.getBoundingClientRect().height,i=r/4;if((e<i||e>r-i)&&!d.current&&t>=0)return;const s=d.current?"auto":"smooth";l.current?.scrollIntoView({behavior:s,block:"center",inline:"center"})}d.current=!1}),[t,a,i,l,u]);const g=(0,j.useCallback)((e=>{c(e),l.current=e||void 0}),[c]);return(0,M.jsx)("div",{dir:"auto",className:(0,s.cx)(V,{[A]:t===i,[R]:t>i,[P]:!a}),"data-testid":"fullscreen-lyric",ref:g,onClick:e=>n(e,i),children:r})})),W={start:0,end:1,text:""},z=j.memo((function({trackUri:e,data:r}){const{lyrics:i=[],provider:s,providerLyricsId:t,providerDisplayName:a,syncType:n,isTimeSynced:c}=r,{spec:o,logger:l}=(0,E.fU)(I.createDesktopLyricsEventFactory,{data:{uri:e}}),[d]=(0,D.z)(500,(r=>r?.item?.uri===e)),u=(0,g.Y)((e=>e?.playbackId??void 0)),m=function(e){const{trackUri:r,format:i,provider:s,providerLyricsId:t,syncType:a,playbackId:n}=e,[c,o]=(0,j.useState)(!1),[l,d]=(0,j.useState)(0),u=(0,j.useMemo)((()=>(0,_.N)({lyrics_format:i,track_uri:r,provider:s,provider_lyrics_id:t,sync_type:a,playback_id:n})),[i,s,t,a,r,n]);(0,j.useEffect)((()=>{o(!1),d(0)}),[u]);const g=(0,C.s4)();return(0,j.useEffect)((()=>{c||l>=140&&(g.send(u),o(!0))}),[l,c,u,g]),d}({trackUri:e,format:"fullscreen",provider:s,providerLyricsId:t,syncType:n,playbackId:u}),y=(0,j.useCallback)((e=>{e.length>1&&m((r=>r+e.length))}),[m]),v=(0,j.useMemo)((()=>[W,W,...i].map(((e,r)=>({...e,lineNumber:r})))),[i]),f=c?v.findIndex((({start:e,end:r})=>d>=e&&d<r)):-1,p=(0,T.g)(),h=(0,j.useCallback)(((e,r)=>{if(c){const i=v[r].start,s=o.lyricsLineFactory().hitSeekToTime({msToSeekTo:i});l.logInteraction(s);e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),p.seekTo(i);const t=p.getState();t&&!t.isPaused||p.resume()}}),[c,l,v,p,o]);return(0,M.jsx)("div",{className:O,children:(0,M.jsxs)("div",{className:F,children:[!c&&(0,M.jsx)(N.D,{as:"p",variant:"mesto",className:H,dir:"auto",children:w.ag.get("web-player.lyrics.unsynced")}),v.map((({text:e,lineNumber:r})=>(0,M.jsx)(U,{text:e,lineNumber:r,activeLineIndex:f,isTimeSynced:c,onObserve:y,handleLyricsClick:h},r))),a&&(0,M.jsx)(N.D,{as:"p",variant:"mesto",className:Y,dir:"auto",children:w.ag.get("web-player.lyrics.providedBy",a)})]})})}));var J=i(38470);const q="lyrics-lyrics-container",K="IIFWQwWvkxpl3swKeHSx",Q="ihTTWcgqNLcQ_cg7Bubg",$="T67LFP0PElpfkkLuegQt",X="lyrics-lyrics-background",Z="YRcOaDMQH71HylItIhW6",ee="EKdvOmPl7kNCDg_yuma8",re=(0,j.memo)((function({version:e}){const r=[w.ag.get("web-player.lyrics.noLyrics0"),w.ag.get("web-player.lyrics.noLyrics1"),w.ag.get("web-player.lyrics.noLyrics2"),w.ag.get("web-player.lyrics.noLyrics3")];let i;switch(e){case"ad":i=w.ag.get("web-player.lyrics.ad");break;case"error":i=w.ag.get("web-player.lyrics.error");break;case"unavailable":i=r[Math.floor(Math.random()*r.length)];break;default:(0,J.U)(e)}return(0,M.jsx)("div",{className:$,children:(0,M.jsx)("span",{className:ee,children:i})})}));var ie=i(94184),se=i.n(ie),te=i(92949),ae=i(96314),ne=i(21864),ce=i(64570),oe=i(34142),le=i(47921),de=i(32626),ue=i(30005),ge=i(36652),me=i(21691),ye=i(66587);const ve="qnJd7AVNVGM33NxaibzG",fe="tPJJwfJAQV0WDsE9Kfmd",pe=[{volume:ye.B.SING_ALONG_OFF,icon:(0,M.jsx)(te.D,{iconSize:16}),get label(){return w.ag.get("singalong.off")}},{volume:ye.B.HIGH,icon:(0,M.jsx)(ae.d,{iconSize:16}),get label(){return w.ag.get("singalong.more-vocal")}},{volume:ye.B.LOW,icon:(0,M.jsx)(ne.J,{iconSize:16}),get label(){return w.ag.get("singalong.less-vocal")}}],he=j.memo((function({currentTrackUri:e}){const{isSupported:r,volume:i,setVocalVolume:s}=(e=>{const r=(0,m.$)(),[i,s]=(0,j.useState)(ye.B.SING_ALONG_OFF),{isSupported:t}=r.getCapabilities();return(0,j.useEffect)((()=>{r.setStatus(ye.q.DISABLED).then((()=>{s(ye.B.SING_ALONG_OFF)}))}),[e,r]),(0,j.useEffect)((()=>()=>{r.setStatus(ye.q.DISABLED)}),[r]),{isSupported:t,volume:i,setVocalVolume:(0,j.useCallback)((async e=>{e===ye.B.SING_ALONG_OFF?await r.setStatus(ye.q.DISABLED):await r.setStatus(ye.q.ENABLED),await r.setVocalVolume(e),s(e)}),[r])}})(e),t=(0,j.useCallback)((e=>{r&&s(e.volume)}),[r,s]);if(!r)return null;const a=pe.find((e=>e.volume===i)),n=a?.volume===ye.B.SING_ALONG_OFF;return(0,M.jsx)(de.yj,{menu:(0,M.jsxs)(ue.v,{children:[(0,M.jsx)(ge.F,{children:w.ag.get("singalong.title")}),pe.map((e=>(0,M.jsx)(me.s,{role:"menuitemradio","aria-checked":i===e.volume,"aria-label":e.label,onClick:()=>t(e),icon:e.icon,iconPosition:"leading",children:e.label},e.volume)))]}),children:(e,r,i)=>(0,M.jsxs)("button",{onClick:r,ref:i,type:"button",className:se()(ve,{[fe]:n}),children:[n?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(ce.r,{iconSize:16}),(0,M.jsx)(N.D,{variant:"mesto",children:w.ag.get("singalong.button")})]}):(0,M.jsxs)(M.Fragment,{children:[a.icon,(0,M.jsx)(N.D,{variant:"mesto",children:a.label})]}),e?(0,M.jsx)(oe.U,{iconSize:16}):(0,M.jsx)(le.i,{iconSize:16})]})})})),be=(0,M.jsx)("div",{className:Q,children:(0,M.jsx)(f.H,{})}),xe=(0,M.jsx)(re,{version:"error"}),ke=(0,M.jsx)(re,{version:"ad"}),Se=(0,M.jsx)(re,{version:"unavailable"}),Le={active:c.ixZ,inactive:c.Snx,background:c.tGJ,messaging:c.ixZ},je=()=>{const e=(0,m.$)(),{isSupported:r}=e.getCapabilities(),i=(0,o.W6)(d.cp)&&r,a=(0,u.O)(),c=(0,g.Y)((e=>e?.item),((e,r)=>e?.uri===r?.uri)),f=c?.uri||"",p=(0,y.o)(c?.images||void 0,{desiredLabel:"large",desiredSize:600}),{data:h,loading:b,error:x}=L(f,p||c?.images?.[0]?.url||"",i);let k=Le;h?.hasLyrics&&(k={active:h.colors.activeText,inactive:h.colors.text,background:h.colors.background,messaging:h.colors.text}),(0,l.Y)(k.background,Le.background);const S=(0,g.Y)((e=>e?.nextItems?.[0]),((e,r)=>e?.uri===r?.uri));L(S?.uri||"",S?.images?.[0]?.url||"",i);let j=be,N=!1;if(f)if(n().isAd(f))j=ke;else if(x)j=xe;else if(b)j=be;else if(h)if(h.hasLyrics){const e=a.activeDevice?.isLocal??!1;N=i&&h.hasVocalRemoval&&e,j=(0,M.jsx)(z,{trackUri:f,data:h},f)}else j=Se;const I=(0,t.v9)((e=>e.ads.leaderboard.isEnabled)),w={"--lyrics-color-active":k.active,"--lyrics-color-inactive":k.inactive,"--lyrics-color-background":k.background,"--lyrics-color-messaging":k.messaging};return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(v.$,{usePlayingItem:!0,children:"Spotify"}),(0,M.jsxs)("div",{className:(0,s.cx)(q,{[K]:I}),style:w,children:[(0,M.jsx)("div",{className:X}),j,N?(0,M.jsx)("div",{className:Z,children:(0,M.jsx)(he,{currentTrackUri:f})}):null]})]})}}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map